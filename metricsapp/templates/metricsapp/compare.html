{% extends 'metricsapp/base.html' %}

{% load bootstrap3 %}
{% load staticfiles %}
{% load colors %}

{% block additional_head_includes %}
	<script type="text/javascript" src="{% static "metricsapp/compare.js" %}"></script>
	<!-- Bootstrap multiselect -->
	<script type="text/javascript" src="{% static "metricsapp/bootstrap-multiselect.js" %}"></script>
	<link rel="stylesheet" href="{% static "metricsapp/bootstrap-multiselect.css" %}" type="text/css"/>
{% endblock %}

{% block content %}
<div class="page-header">
	<h1>Comparison <small>How teams stack up against one another</a></small></h1>
</div>

<div class="well menu">
	<ul class="nav nav-pills">
		{% for sprint in sprint_list %}
			<li role="presentation" {% if current_sprint == sprint %}class="active"{% endif %}><a href="/compare/sprint/{{ forloop.counter }}?{{ current_parameters }}">{{ sprint }}</a></li>
		{% endfor %}
	</ul>
</div>

<div class="well menu" id="team-select-container">
	<form action="">
		<select id="team-select" name="team" multiple="multiple">
			{% for team, selected in all_teams %}
				<option value="{{ team.name }}" {% if selected %}selected="selected"{% endif %}>{{ team.name }}</option>
			{% endfor %}
		</select>
		<button type="submit" value="update" class="btn btn-info" style="float:right"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span> Update teams</button>
	</form>
</div>

<div class="jumbotron" id="score_keeper">
	<div>
		<canvas id="compare" width="100%" height="450px"></canvas>
	</div>
	<div id="key">
		{% for team, score_list in metric_list %}
			<span style="color: {{ team.label_color }}">{{ team.name }}</span>
		{% endfor %}
	</div>
</div>

<script type="text/javascript">
	var compare_data = {
		labels: {{ compare_chart_labels|safe }},
		datasets: [
			{% for team, score_list in metric_list %}
				{
					label: "{{ team.name }}",
					fillColor: "rgba(1,1,1,0.0)",
					// fillColor: "{{ team.label_color|hex_to_rgb:'rgba({r},{g},{b},0.1)' }}",
					strokeColor: "{{ team.label_color }}",
					pointColor: "{{ team.label_color }}",
					pointStrokeColor: "#fff",
					pointHighlightFill: "#fff",
					pointHighlightStroke: "rgba(151,187,205,1)",
					data: {{ score_list }}
				},
			{% endfor %}
		]
	};
</script>

{% endblock %}{# content#}